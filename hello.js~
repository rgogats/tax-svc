var http = require('http');

var express = require('express');
var app = express();
var bodyParser = require('body-parser');

app.use(bodyParser.urlencoded({ extended: true })); 

app.use(express.static(__dirname + '/public'));

// views is directory for all template files
app.set('views', __dirname + '/views');
app.set('view engine', 'ejs');

var taxRateByState = {
    "AL": 0.0901,
    "AK": 0.0176,
    "AZ": 0.0825,
    "AR": 0.093,
    "CA": 0.0825,
    "CO": 0.075,
    "CT": 0.0635,
    "DE": 0.0,
    "DC": 0.0575,
    "FL": 0.068,
    "GA": 0.07,
    "HI": 0.0435,
    "ID": 0.0603,
    "IL": 0.0864,
    "IN": 0.07,
    "IA": 0.068,
    "KS": 0.0862,
    "KY": 0.06,
    "LA": 0.0998,
    "ME": 0.055,
    "MD": 0.06,
    "MA": 0.0625,
    "MI": 0.06,
    "MN": 0.073,
    "MS": 0.0707,
    "MO": 0.0789,
    "MT": 0.0,
    "NE": 0.0689,
    "NV": 0.0798,
    "NH": 0.0,
    "NJ": 0.0685,
    "NM": 0.0755,
    "NY": 0.0848,
    "NC": 0.069,
    "ND": 0.0678,
    "OH": 0.0714,
    "OK": 0.0886,
    "OR": 0.0,
    "PA": 0.0634,
    "RI": 0.07,
    "SC": 0.0722,
    "SD": 0.0639,
    "TN": 0.0946,
    "TX": 0.0819,
    "UT": 0.0676,
    "VT": 0.0618,
    "VA": 0.0563,
    "WA": 0.0892,
    "WV": 0.0629,
    "WI": 0.0542,
    "WY": 0.054
}
var total = 0;
var state = '';

app.get('*', function(req, res) {
	res.render('app', {taxRateByState: taxRateByState, total: total, state: state});

});


app.post('/calculateTaxRate', function(req, res) {
	var dollarValue = parseFloat(req.body.money);
	state = req.body.state;
	total = (dollarValue * (1 + taxRateByState[state])).toFixed(2);	
	
	res.redirect('/');


});

app.listen(8080);
